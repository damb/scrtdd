<?xml version="1.0" encoding="UTF-8"?>
<seiscomp>
    <module name="scrtdd" category="Processing" inherit-global-bindings="true">
        <description>Double-Difference relocation module for real-time and catalogs relocation</description>
        <configuration>

            <parameter name="onlyPreferredOrigins" type="boolean" default="true">
                <description>
                  Relocate only preferred origins. When disabled scrtdd listens to LOCATION group
                  and tries to relocate any origin. When enabled scrtdd listens to EVENT group
                  and tries to relocate the preferred origin of an event.
                </description>
              </parameter>

            <parameter name="automaticOrigins" type="boolean" default="true">
                <description>
                    Allow relocation of automatic origins 
                </description>
            </parameter>

            <parameter name="manualOrigins" type="boolean" default="true">
                <description>
                    Allow relocation of automatic origins 
                </description>
            </parameter>

            <parameter name="workingDirectory" type="path" default="@ROOTDIR@/var/lib/rtdd">
                <description>
                    Defines the directory used for storing processing files (waveforms cache
                    and debugging files).
                </description>
            </parameter>

            <parameter name="saveProcessingFiles" type="boolean" default="false">
                <description>
                    Store adavanced processing information files in the working directory
                    (useful for debugging/troubleshooting).
                </description>
            </parameter>

            <parameter name="activeProfiles" type="list:string" default="">
                <description>
                    Defines a list of active profiles.
                </description>
            </parameter>

            <group name="performance">

                <parameter name="profileTimeAlive" type="int" default="-1">
                    <description>
                        Defines how long the profile data should be kept in memory (in seconds). This is useful
                        to release memory (e.g. catalog waveform data) after a period of inactivity at the cost of
                        re-loading and re-process the waveforms whenever a new event occurs (not 
                        very time consuming but still a bit slower than keeping the waveforms in memory).
                        A negative value force the profile to never expires (always in memory).
                    </description>
                </parameter>

                <parameter name="cacheWaveforms" type="boolean" default="true">
                    <description>
                        Save catalog waveforms to local disk after they have been loaded the first
                        times. This avoid re-reading them from the configured recordStream in the 
                        future since this operation is drammatically slow (unless the recordstream
                        points to a local disk source, in which case there is no advantace in
                        caching the waveforms).
                        It is safe to delete the cache folder, in which case the waveforms will be
                        loaded and saved again on disk the next time the profile is loaded (they will
                        be read again from the configured recordStream).
                        Please note that exists a command line options '--load-profile-wf' useful to
                        load all the catalog waveforms from the record stream and save them on disk.                         This is useful to make sure all the wavefrorms are on disk before when the
                        module is started and avoid lenghty loading the first time the module starts.
                    </description>
                </parameter>

        </group>

            <group name="cron">

                <parameter name="delayTimes" type="list:int" default="60,300">
                    <description>
                    Specifies a delay time in seconds, relative to origin time,
                    to trigger the processing. This can be a single value or a list of delay
                    times. The list case can be useful when a quick solution is wanted but
                    more data (e.g. waveforms) becomes available at a later time. In this
                    scenario multiple times are configured so that an early solution is attempted
                    and a more refined one is computed later.
                    Example: &quot;60, 120, 300, 3600&quot;
                    </description>
                </parameter>

                <parameter name="logging" type="boolean" default="true">
                    <description>
                    Enables/disables updating of a cron log file. This file will be
                    created at ~/.seiscomp3/log/[appname].sched
                    and contains information about the scheduled events and the
                    processing queue.
                  </description>
                </parameter>

            </group>

            <group name="profile">
                <description>
                    Defines regional profiles. Origins that fall within a profile region will use
                    the profile configuration. If an origin falls in multiple profile regions, then
                    the profile defined first in activeProfile option will be used.
                    This allows for hierarchical regions, where special regions are defined
                    first and then a generic and broad region is defined as last entry to be used as
                    default configuration.
                    The region check is not used for multi-event relocation (see --relocate-profile
                    command line option)
                </description> 
                <struct type="rtdd profile" link = "rtdd.activeProfiles">
                    <parameter name="regionType" type="string" default="CIRCULAR" >
                        <description>
                            Type of region: RECTANGULAR or CIRCULAR
                        </description>
                    </parameter>

                    <parameter name="region" type="list:double">
                        <description>
                            Defines the region values. If regionType is RECTANGULAR then 4 values
                            (min_lat, min_lon, max_lat, max_lon) are expected. If regionType
                            is CIRCULAR then 3 values are expected (lat, lon, radius in km).
                            If region is empty, then it will represent a region that matches any
                            origin.
                        </description>
                    </parameter>

                    <parameter name="earthModelID" type="string">
                        <description>
                            earthModelID that is stored in the created origin.
                        </description>
                    </parameter>

                    <parameter name="methodID" type="string" default="RTDD">
                        <description>
                            methodID that is stored in the created origin.
                        </description>
                    </parameter>

                    <group name="catalog">
                        <description>
                            Define a catalog for this profile. In real-time mode this represents the 
                            background catalog used as base catalog to relocate origins received from
                            the messaging system.
                            In multi-event mode, this represents the catalog to be relocated
                            as a whole (see --relocate-profile command line option).
                            There are two ways to define a catalog file: one is providing a single 
                            file containing the ids of existing origins; the second way consists in
                            providing 3 files event, phase and stations (in this format the origins
                            don't need to be present in the database).
                            The files must be in csv format with the first line containing the
                            column names. Each file requires a minimum set of columns, which can
                            appear in any order. Additional columns can be present and will not be
                            used.
                        </description>

                        <parameter name="eventFile" type="path">
                            <description>
                                Path to event file to be used for this profile.
                                Seiscomp format required columns: seiscompId (this must be a valide seiscomp3 origin id)
                                Extended format columns: id,isotime,latitude,longitude,depth,magnitude,horiz_err,depth_err,tt_residual
                                If the extended format is used, then the phase and station files must be provided.
                                Conversely, if the format used is the one with seiscompId, no other files have to be
                                provided and the event information will be fetched from the database.
                            </description>
                        </parameter>

                        <parameter name="phaFile" type="path">
                            <description>
                                Path to catalog picks file to be used for this profile 
                                Columns: eventId,stationId,isotime,lowerUncertainty,upperUncertainty,type,networkCode,stationCode,locationCode,channelCode,evalMode
                            </description>
                        </parameter>

                        <parameter name="stationFile" type="path">
                            <description>
                                Path to the stations file to be used for this profile
                                Columns: id,latitude,longitude,elevation,networkCode,stationCode,locationCode
                            </description>
                        </parameter>

                        <parameter name="P-Phases" type="list:string" default="Pg,P">
                            <description>
                                Defines a priority list of accepted P phases. Phases not in the list will be discarded.
                                if multiple phases exist for the same event/station pair, the first one in the list will be used.
                            </description>
                        </parameter>

                        <parameter name="S-Phases" type="list:string" default="Sg,S">
                            <description>
                                Defines a priority list of accepted S phases. Phases not in this list will be discarded.
                                if multiple phases exist for the same event/station pair, the first one in the list will be used.
                            </description>
                        </parameter>

                    </group>

                    <group name="doubleDifferenceObservationsNoXcorr">
                        <description>
                            These options control the creation of double-difference observations
                            without cross-correlation and are used only in real-time single event
                            relocation but NOT in multi-event relocation (--relocate-profile 
                            command line option).
                            The real-time relocation works in two steps: the first one refines the
                            initial location creating double-difference observations from absolute
                            travel time differences and solving the system. The first step is
                            controlled by this option group.
                            A second step is then performed, starting from the refined location 
                            and solving again a double-difference system but this time using both
                            absolute travel times difference and cross correlation differential
                            travel times observations. The second step is controlled by 
                            'doubleDifferenceObservations' option group.
                        </description>
                        <group name="clustering">
                            <description>
                                Those options control the selection of event pairs and the phases
                                within pairs, to be used to create double-difference observations.
                                Wihtin an event pair, an observation is created for every station
                                for which exist phases for both events.
                                To build the event pairs a clustering algorithm is performed, joining
                                together events within a given distance and fulfilling specific
                                requirements which are configurable in here
                            </description>
                            <parameter name="minNumNeigh" type="int">
                                <description>
                                    Minimum number of neighboring events required to relocate an event.
                                    Useful to avoid inclusion of poorly constrained events.
                                </description>
                            </parameter>
                            <parameter name="maxNumNeigh" type="int">
                                <description>
                                  Maximum number of neighbors per event. Useful to reduce
                                  computation time when relocating a large number events.
                                  This value should be consistent with numEllipsoids parameter (that
                                  is numEllipsoids * 8) if numEllipsoids is not 0.
                                  A value of 0 or less disables this limit
                                </description>
                            </parameter>
                            <parameter name="minObservationPerEvtPair" type="int" >
                                <description>
                                    Minimum number of differential travel times (Including P+S) per
                                    event pair required.
                                    Event pairs not satisfying this condition will not be used.
                                    Useful to force inclusion of well connected
                                    neighbours only.
                                </description>
                            </parameter>
                            <parameter name="maxObservationPerEvtPair" type="int" >
                                <description>
                                    Maximum number of differential travel times (Including P+S) per 
                                    event pair used.
                                    If this value is set, closer stations will have higher 
                                    precedence over further ones.
                                    A value of 0 or less disables this limit
                                </description>
                            </parameter>
                            <group name="neighboringEventSelection">
                                <description>
                                    This option define how neighbouring events are selected.
                                    From Waldhauser 2009: "to assure a spatially homogeneous subsampling, reference
                                    events are selected within each of five concentric, vertically elongated
                                    ellipsoidal layers of increasing thickness.
                                    The dimension of the ellipsoid is based on the assumed error in the routine
                                    locations and the maximum interevent distance over which model errors can still
                                    be effectively minimized (see Waldhauser, 2001).
                                    The layers are twice as thick at the poles than they are at the equator to 
                                    accommodate the generally larger error in the depth of the routine location of
                                    a new event. Each layer is split up into its eight quadrants (or cells), and 
                                    the  neighboring events are selected from each of the 40 cells."
                                    SCRTDD selects neighbours for each ellipsoid/quadrant conbination in
                                    a round robin fashion until "maxNumNeigh" is reached. If there are no events
                                    in a specific ellipsoid/quadrant location it is simply skipped.
                                    Note: if numEllipsoids is 0 then the concentric ellipsoid algorithm will not
                                    be used and the events will be selected on nearest neighbor basis within a
                                    search distance of maxEllipsoidSize. This is useful when performing multi-event
                                    relocation to build a background catalog where we seek a network of links between
                                    events so that there exists a chain of pairwise connected events from any one
                                    event to any other event, with the distance being as small as possible between
                                    connected events
                                </description>
                                <parameter name="numEllipsoids" type="int" default="5">
                                    <description>
                                        Number of concentric ellipsoidal layers to use in neighboring events 
                                        selection. if maxNumNeigh is not set this parameter does not have effects.
                                        If maxNumNeigh is used, make it consistent with numEllipsoids 
                                        (numEllipsoids * 8) if numEllipsoids is not 0
                                    </description>
                                </parameter>
                                <parameter name="maxEllipsoidSize" type="double" default="5">
                                    <description>
                                        Horizontal axis length (km) of the outermost boundary. Each inner
                                        concentric layer axis will be of size/2 of the previous one. Please note
                                        that the horizontal axis size is half of the vertical one.
                                    </description>
                                </parameter> 
                            </group>
                            <group name="phaseSelection">
                                <description>
                                    This option define how event phases are selected. 
                                </description>
                                <parameter name="minStationDistance" type="double">
                                    <description>
                                        Minimum distance (km) between event pair and station required
                                        to use a phase in the double-difference observations. 
                                        Phases belonging to stations not satisfyig this condition 
                                        will not be used
                                    </description>
                                </parameter>
                                <parameter name="maxStationDistance" type="double">
                                    <description>
                                        Max distance (km) between event pair and station allowed
                                        to use a phase in the double-difference observations.
                                        Phases belonging to stations not satisfyig this condition 
                                        will not be used.
                                        A value of 0 or less disables this limit
                                    </description>
                                </parameter>
                                <parameter name="minStationToEventPairDistRatio" type="double">
                                    <description>
                                        Minimum ratio between event-station distance and pair 
                                        inter-event-pair distance. Phases belonging to stations 
                                        not satisfyig this condition will not be used
                                    </description>
                                </parameter>  
                            </group> 
                        </group> 
                    </group>

                    <group name="doubleDifferenceObservations">
                        <description>
                            These options control the creation of double-difference observations
                            with cross-correlation and are used both in real-time single event
                            relocation and in multi-event relocation (--relocate-profile 
                            command line option).
                            The real-time relocation works in two steps: the first one refines the
                            initial location creating double-difference observations from absolute
                            travel time differences and solving the system. The first step is
                            controlled by 'doubleDifferenceObservationsNoXcorr' option group.
                            A second step is then performed, starting from the refined location 
                            and solving again a double-difference system but this time using both
                            absolute travel times difference and cross correlation differential
                            travel times observations. The second step is controlled by this
                            option group.
                            The multi-event relocation works in one step only and it uses this 
                            option group.
                        </description>
                        <group name="clustering">
                            <description>
                                Those options control the selection of event pairs and the phases
                                within pairs, to be used to create double-difference observations.
                                Wihtin an event pair, an observation is created for every station
                                for which exist phases for both events.
                                To build the event pairs a clustering algorithm is performed, joining
                                together events within a given distance and fulfilling specific
                                requirements which are configurable in here
                            </description>
                            <parameter name="minNumNeigh" type="int">
                                <description>
                                    Minimum number of neighboring events required to relocate an event.
                                    Useful to avoid inclusion of poorly constrained events.
                                </description>
                            </parameter>
                            <parameter name="maxNumNeigh" type="int">
                                <description>
                                  Maximum number of neighbors per event. Useful to reduce
                                  computation time when relocating a large number events.
                                  This value should be consistent with numEllipsoids parameter (that
                                  is numEllipsoids * 8) if numEllipsoids is not 0.
                                  A value of 0 or less disables this limit
                                </description>
                            </parameter>
                            <parameter name="minObservationPerEvtPair" type="int" >
                                <description>
                                    Minimum number of differential travel times (Including P+S) per
                                    event pair required.
                                    Event pairs not satisfying this condition will not be used.
                                    Useful to force inclusion of well connected
                                    neighbours only.
                                </description>
                            </parameter>
                            <parameter name="maxObservationPerEvtPair" type="int" >
                                <description>
                                    Maximum number of differential travel times (Including P+S) per 
                                    event pair used.
                                    If this value is set, closer stations will have higher 
                                    precedence over further ones.
                                    A value of 0 or less disables this limit
                                </description>
                            </parameter>
                            <group name="neighboringEventSelection">
                                <description>
                                    This option define how neighbouring events are selected.
                                    From Waldhauser 2009: "to assure a spatially homogeneous subsampling, reference
                                    events are selected within each of five concentric, vertically elongated
                                    ellipsoidal layers of increasing thickness.
                                    The dimension of the ellipsoid is based on the assumed error in the routine
                                    locations and the maximum interevent distance over which model errors can still
                                    be effectively minimized (see Waldhauser, 2001).
                                    The layers are twice as thick at the poles than they are at the equator to 
                                    accommodate the generally larger error in the depth of the routine location of
                                    a new event. Each layer is split up into its eight quadrants (or cells), and 
                                    the  neighboring events are selected from each of the 40 cells."
                                    SCRTDD selects neighbours for each ellipsoid/quadrant conbination in
                                    a round robin fashion until "maxNumNeigh" is reached. If there are no events
                                    in a specific ellipsoid/quadrant location it is simply skipped.
                                    Note: if numEllipsoids is 0 then the concentric ellipsoid algorithm will not
                                    be used and the events will be selected on nearest neighbor basis within a
                                    search distance of maxEllipsoidSize. This is useful when performing multi-event
                                    relocation to build a background catalog where we seek a network of links between
                                    events so that there exists a chain of pairwise connected events from any one
                                    event to any other event, with the distance being as small as possible between
                                    connected events
                                </description>
                                <parameter name="numEllipsoids" type="int" default="5">
                                    <description>
                                        Number of concentric ellipsoidal layers to use in neighboring events 
                                        selection. if maxNumNeigh is not set this parameter does not have effects.
                                        If maxNumNeigh is used, make it consistent with numEllipsoids 
                                        (numEllipsoids * 8) if numEllipsoids is not 0
                                    </description>
                                </parameter>
                                <parameter name="maxEllipsoidSize" type="double" default="5">
                                    <description>
                                        Horizontal axis length (km) of the outermost boundary. Each inner
                                        concentric layer axis will be of size/2 of the previous one. Please note
                                        that the horizontal axis size is half of the vertical one.
                                    </description>
                                </parameter> 
                            </group>
                            <group name="phaseSelection">
                                <description>
                                    This option define how event phases are selected. 
                                </description>
                                <parameter name="minStationDistance" type="double">
                                    <description>
                                        Minimum distance (km) between event pair and station required
                                        to use a phase in the double-difference observations. 
                                        Phases belonging to stations not satisfyig this condition 
                                        will not be used
                                    </description>
                                </parameter>
                                <parameter name="maxStationDistance" type="double">
                                    <description>
                                        Max distance (km) between event pair and station allowed
                                        to use a phase in the double-difference observations.
                                        Phases belonging to stations not satisfyig this condition 
                                        will not be used.
                                        A value of 0 or less disables this limit
                                    </description>
                                </parameter>
                                <parameter name="minStationToEventPairDistRatio" type="double">
                                    <description>
                                        Minimum ratio between event-station distance and pair 
                                        inter-event-pair distance. Phases belonging to stations 
                                        not satisfyig this condition will not be used
                                    </description>
                                </parameter> 
                            </group>
                        </group>

                        <group name="crosscorrelation">
                            <group name="p-phase">
                                <parameter name="minCCCoef" type="double" default="0.50">
                                    <description>
                                        Min crosscorrelation coefficient accepted to use a differential travel time
                                    </description>
                                </parameter>
                                <parameter name="start" type="double" default="-0.50">
                                    <description>
                                        Start of data window to cross correlate with respect to pick time (+/- secs)
                                    </description>
                                </parameter>
                                <parameter name="end" type="double" default="0.50">
                                    <description>
                                        End of data window to cross correlate with respect to pick time (+/- secs)
                                    </description>
                                </parameter>
                                <parameter name="maxDelay" type="double" default="0.350">
                                    <description>Maximum data windows lag accepted (secs)</description>
                                </parameter>
                                <parameter name="components" type="list:string" default="Z">
                                    <description>
                                        Priority list of components to be used in cross-correlation.
                                        If cross-correlation is below threshold on a component, the next
                                        component is tried.
                                    </description>
                                </parameter>
                            </group>
                            <group name="s-phase">
                                <parameter name="minCCCoef" type="double" default="0.50">
                                    <description>
                                        Min crosscorrelation coefficient accepted to use a differential travel time
                                    </description>
                                </parameter>
                                <parameter name="start" type="double" default="-0.50">
                                    <description>
                                        Start of data window to cross correlate with respect to pick time (+/- secs)
                                    </description>
                                </parameter>
                                <parameter name="end" type="double" default="0.75">
                                    <description>
                                        End of data window to cross correlate with respect to pick time (+/- secs)
                                    </description>
                                </parameter>
                                <parameter name="maxDelay" type="double" default="0.350">
                                    <description>Maximum data windows lag accepted (secs)</description>
                                </parameter>
                                <parameter name="components" type="list:string" default="T,Z">
                                    <description>
                                        Priority list of components to be used in cross-correlation.
                                        If cross-correlation is below threshold on a component, the next
                                        component is tried.
                                    </description>
                                </parameter>
                            </group>
                            <group name="options">
                                <parameter name="maxStationDistance" type="double" default="85">
                                    <description>
                                        Max distance (km) between event and station allowed.
                                        Phases belonging to furhter stations will not be used
                                        in cross-correlation. Set it to -1 to remove limits
                                    </description>
                                </parameter> 
                                <parameter name="maxInterEventDistance" type="double" default="-1">
                                    <description>
                                        Max distance (km) between events allowed.
                                        Event pairs whose inter-event distance if further than 
                                        this value will not be used in cross-correlation.
                                        Set it to -1 to remove limits 
                                    </description>
                                </parameter>
                                <parameter name="theoreticalPhaseAutoOrigin" type="boolean" default="true">
                                    <description>
                                        Automatic origins: cross-correlate actual phases against 
                                        theoretical ones. This allows to increase the number of
                                        double-difference observations and so the accuracy of the
                                        relocations. For automatic origins this improves considerably
                                        the relocation results
                                    </description>
                                </parameter>

                                <parameter name="theoreticalPhaseManualOrigin" type="boolean" default="false">
                                    <description>
                                        Manual origins: cross-correlate actual phases against 
                                        theoretical ones. This allows to increase the number of
                                        double-difference observations and so the accuracy of the
                                        relocations. Normally this increases the quality of the
                                        relocations even when the manual origins have many good
                                        manuallly picked phases. Since this feature is a bit slower
                                        it should be enabled only at the end of the parameters 
                                        tuning process to avoid lengthy relocations
                                    </description>
                                </parameter>
                            </group>
                        </group>

                        <group name="waveformFiltering">
                            <description>
                                Filter waveforms before performing the cross correlation
                            </description>
                            <parameter name="filterString" type="string" default="ITAPER(1)>>BW_HLP(2,1,20)">
                                <description>
                                    SeisComP3 string based filter definition. Set to "" to disable filtering
                                </description>
                            </parameter>
                            <parameter name="resampling" type="double" default="400">
                                <description>
                                    Resample all traces at this samplig interval (hz)
                                    Set it to 0 to not resample
                                </description>
                            </parameter>
                        </group>

                        <group name="snr">
                           <description>
                               Exclude phases from cross correlation when Signal to Noise Ratio is below
                               a configured threshold.
                           </description>
                           <parameter name="minSnr" type="double" default="2">
                                <description>
                                    Minimum Signal to Noise Ratio value required to use a Pick in cross correlation.
                                    If minSnr is used, then the noise and signal windows must be defined too.
                                </description>
                            </parameter>
                            <parameter name="noiseStart" type="double" default="-3">
                                <description>Start of noise  window with respect to pick time (+/- secs)</description>
                            </parameter>
                            <parameter name="noiseEnd" type="double" default="-0.350">
                                <description>End of noise  window with respect to pick time (+/- secs)</description>
                            </parameter>
                            <parameter name="signalStart" type="double" default="-0.350">
                                <description>Start of signal window with respect to pick time (+/- secs)</description>
                            </parameter>
                            <parameter name="signalEnd" type="double" default="0.350">
                                <description>End of signal window with respect to pick time (+/- secs)</description>
                            </parameter> 
                        </group>
                    </group>

                    <group name="solver">
                        <description>
                            Configuration for the double-difference equations system solver.
                            The solver finds the solution to the double-difference system (the
                            origin locations/times) starting from the initial origins locations,
                            then it iterates the process multiple times updating the
                            double-difference observations based on the previous iteration solutions
                            and also updating the observations weights accordingly to
                            downWeightingByResidual settings.
                          </description>
                        <parameter name="solverType" type="string" default="LSMR" >
                            <description>
                                Solver algorithm to use: either LSMR or LSQR. Both works solving
                                the double-difference equations system in a least squares sense.
                                LSMR is based on Fong and Saunders algorithm from 2010. LSQR is
                                based on Paige and Saunders algorithm from 1982
                            </description>
                       </parameter>
                        <parameter name="algoIterations" type="int" default="20">
                            <description>
                              This parameter control how many iterations the solver performs.
                               The logs of the relocation contain information on the residuals
                               of the double-difference system at the end of each iteration.
                               That information should be used to evaluate when it is worth
                               increasing/decreasing the number of interations.
                            </description>
                        </parameter>
                        <parameter name="useTTResiduals" type="boolean" default="true">
                          <description>Include travel time residuals in the double-difference
                            system. The relocated origins will improve in absolute locations                              but the relative locations might lose in resolution
                          </description> 
                        </parameter>
                        <group name="downWeightingByResidual">
                            <description>
                                Initially all double-difference observations have weight 1.0 (unless
                                a priori weights options is used). In subsequent 
                                iterations each observation is downweighted accordingly to its 
                                residuals, which allows to eventualy get rid of bad observations 
                                and also to scale observation wights accordingly to their quality 
                                and resolution (e.g. absolute travel time differences vs 
                                cross-correlation ones).
                                The values to be configured here express the standard deviations of 
                                the double-difference observation residuals beyond which the
                                observations are dropped (their weight becomes 0). Values lower
                                that the configured threshold are donweighted accordingly to their
                                residual value (see Waldhauser/Ellsworth paper)
                                A value of 0 disables downweighting
                            </description> 
                            <parameter name="startingValue" type="double" default="10">
                              <description>Value for the first iteration of the solver</description> 
                            </parameter>
                            <parameter name="finalValue"    type="double" default="3">
                              <description>Value for the last iteration of the solver</description> 
                            </parameter> 
                        </group> 
                        <group name="dampingFactor">
                          <description>
                            Setting a value different than 0 enables the solver to use a damped
                            (regularized) least squares system.
                            The damping factor value constrains the changes in earthquakes
                            parameters (location and time) preventing them becoming very large,
                            and it also helps in case of ill-conditioned systems.
                            A too high value prevents the events from changing at all. A too low
                            value might result in a huge shift of the event cluster after
                            relocation, although the structure should persists.
                            </description> 
                            <parameter name="startingValue" type="double" default="0.3">
                              <description>Value for the first iteration of the solver</description> 
                            </parameter>
                            <parameter name="finalValue"    type="double" default="0.3">
                              <description>Value for the last iteration of the solver</description> 
                            </parameter>
                        </group>
                        <group name="aPrioriWeights">
                            <description>
                                Those options allow the double-difference equations to have different
                                starting weights. By default they are equally weighted and the
                                residual itselfs drive the re-weighting (see downWeightingByResidual
                                option). So these settings shouldn't be strictly necessary but
                                it could be interesting to experiment with them
                            </description>
                            <parameter name="usePickUncertainties" type="boolean" default="false">
                                <description>
                                   Observation weights are scaled based on pick uncertainties.
                                   This should be enabled only if uncertainties are used for manual
                                   picks otherwise there is no way to properly access pick quality
                                   and consequently the observation weight.
                                </description>
                            </parameter>
                            <parameter name="absoluteTTObsWeight" type="double" default="1.0">
                                <description>
                                    Starting weight for observations coming from difference
                                    in absolute travel times.
                                    Useful to give more weight to xcorr observations than
                                    absolute travel time ones.
                                </description>
                            </parameter>
                            <parameter name="xcorrObsWeight" type="double" default="1.0">
                                <description>
                                    Starting weight for observations coming from lag measured
                                    via cross-correlation.
                                    Useful to give more weight to cross-correlation observations
                                    than absolute travel time ones.
                                </description>
                            </parameter>
                        </group>
                        <group name="travelTimeTable">
                            <description>
                                Traveltime table used by the solver (LOCSAT or libtau). This
                                can be a system default or a user custom travel time table.
                            </description> 
                            <parameter name="tableType" type="string" default="libtau">
                            </parameter>
                            <parameter name="tableModel" type="string" default="iasp91">
                            </parameter> 
                        </group>  
                    </group>
                </struct>
            </group>

        </configuration>
        <command-line>
            <group name="Generic">
                <optionReference>generic#help</optionReference>
                <optionReference>generic#version</optionReference>
                <optionReference>generic#config-file</optionReference>
                <optionReference>generic#plugins</optionReference>
                <optionReference>generic#daemon</optionReference>
                <optionReference>generic#auto-shutdown</optionReference>
                <optionReference>generic#shutdown-master-module</optionReference>
                <optionReference>generic#shutdown-master-username</optionReference>
            </group>
            
            <group name="Verbosity">
                <optionReference>verbosity#verbosity</optionReference>
                <optionReference>verbosity#v</optionReference>
                <optionReference>verbosity#quiet</optionReference>
                <optionReference>verbosity#component</optionReference>
                <optionReference>verbosity#syslog</optionReference>
                <optionReference>verbosity#lockfile</optionReference>
                <optionReference>verbosity#console</optionReference>
                <optionReference>verbosity#debug</optionReference>
                <optionReference>verbosity#log-file</optionReference>
            </group>
            
            <group name="Messaging">
                <optionReference>messaging#user</optionReference>
                <optionReference>messaging#host</optionReference>
                <optionReference>messaging#timeout</optionReference>
                <optionReference>messaging#primary-group</optionReference>
                <optionReference>messaging#subscribe-group</optionReference>
                <optionReference>messaging#encoding</optionReference>
                <optionReference>messaging#start-stop-msg</optionReference>
            </group>

            <group name="Database">
                <optionReference>database#db-driver-list</optionReference>
                <optionReference>database#database</optionReference>
                <optionReference>database#config-module</optionReference>
                <optionReference>database#inventory-db</optionReference>
                <optionReference>database#db-disable</optionReference>
            </group>

            <group name="Records">
                <optionReference>records#record-driver-list</optionReference>
                <optionReference>records#record-url</optionReference>
                <optionReference>records#record-file</optionReference>
                <optionReference>records#record-type</optionReference>
            </group>

            <group name="Mode">

                <option long-flag="load-profile-wf" argument="profile">
                    <description>Load catalog waveforms from the configured recordstream and save them in the working directory configured for the profile</description>
                </option>

                <option long-flag="debug-wf">
                    <description>Enable the dumping of waveforms (filtered and resampled phases, artificial phases, SNR rejected phases) into the profile working directory ('cacheWaveforms' folder). Useful when run in combination with --load-profile-wf</description>
                </option>

                <option long-flag="eval-xcorr" argument="profile">
                    <description>"Evaluate cross-correlation settings for the given profile</description>
                </option>

                <option long-flag="expiry" flag="x" argument="hours">
                    <description>Time span in hours after which objects expire</description>
                </option>

                <option long-flag="dump-config">
                    <description>Dump the configuration and exit</description>
                </option>

            </group>
            <group name="Catalog">

                <option long-flag="dump-catalog" argument="catalog-file">
                    <description>Dump the seiscomp event/origin id file passed as argument into a catalog file triplet (station.csv,event.csv,phase.csv)</description>
                </option>

                <option long-flag="dump-catalog-options" argument="type,evalmode,includeCreator,excludeCreator,region">
                    <description>Allows --dump-catalog to accept event ids besides origin ids. For each event id an origin will be selected following the provided options whose format is: 'type,evalmode,includeCreator,excludeCreator,region', where type=preferred|last|first  evalmode=any|onlyManual|onlyAutomatic  includeCreator=any|author|methodID  excludeCreator=none|author|methodID  region=any|profileName e.g. to select preferred origins within my profile region given the input event ids use 'preferred,any,any,none,myProfile'
                    </description>
                </option>

                <option long-flag="dump-catalog-xml" argument="catalog-files">
                    <description>Convert the input catalog into XML format. The input can be a single file (containing seiscomp event/origin ids) or a catalog file triplet (station.csv,event.csv,phase.csv)</description>
                </option>

                <option long-flag="merge-catalogs" argument="catalog-files">
                    <description>Merge in a single catalog all the catalog file triplets (station1.csv,event1.csv,phase1.csv,station2.csv,event2.csv,phase2.csv,...) passed as arguments.</description>
                </option>

                <option long-flag="merge-catalogs-keepid" argument="catalog-files">
                    <description>Similar to --merge-catalogs option but events keeps their ids. If multiple events share the same id, subsequent events will be discarded.</description>
                </option>

            </group>
            <group name="SingleEvent">

                <option long-flag="origin-id" flag="O" argument="origin-id">
                    <description>Relocate the origin (or multiple comma-separated origins) and send a message. Each origin will be processed accordingly with the matching profile region unless --profile option is used</description>
                </option>

                <option long-flag="ep" argument="xml-file">
                    <description>Event parameters XML file for offline processing of contained origins (imply test option). Each origin will be processed accordingly with the matching profile region unless --profile option is used</description>
                </option>

                <option long-flag="test">
                    <description>"Test mode, no messages are sent</description>
                </option>

                <option long-flag="profile" argument="profile">
                    <description>
                        Force a specific profile to be used when relocating an origin. This overrides the selection 
                        of profiles based on region information and the initial origin location
                    </description>
                </option>

            </group>

            <group name="MultiEvents">

                <option long-flag="reloc-profile" argument="profile">
                    <description>Relocate the catalog of profile passed as argument</description>
                </option>
 
            </group>

        </command-line>
    </module>

</seiscomp>
